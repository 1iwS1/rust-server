# rust-server (Secret Santa)

Sercret Santa project, which includes one bin crate

You need to install nightly Rust and then use it to compile the program

rustup install nightly

cargo +nightly install racer


API

# Методы
## GET /users - получить список пользователей
- Возвращает JSON объект соответствия между ID пользователя и его именем для всех пользователей сервиса.

```json
// Out
{
  "0":"Timur",
  "1":"Nikita"
}
```

## GET /groups - получить список групп
- Возвращает JSON объект соответствия между ID группы и ее статусом закрытости для всех групп сервиса.
```json
// Out
{
  "0":true,
  "1":false
}
```

## POST /user/create - создать пользователя
- Принимает JSON объект с полем `name` равным требуемому имени нового пользователя. Возвращает JSON объект с полем `id` равным ID нового пользователя в случае успеха, код возврата `200`.
- Если имя - пустая строка, возвращает JSON объект с полем `error` равным сообщению об ошибке, код возврата `400`.
- Если входные данные неверного формата (`{"name":"Maxim"}`), то сервер паникует, а клиент не получает ответ на свой запрос.

Пример правильного обмена данными:
```json
// In
{
  "name":"Maxim"
}

// Out
{
  "id":"2"
}
```

## POST /group/create - создать группу
- Принимает JSON объект с полем `creator_id` равным `id` создателя группы. Возвращает JSON объект с полем `id` равным ID новой группы в случае успеха, код возврата `200`.
- Если `id` создателя нет в базе возвращает JSON объект с полем error равным сообщению об ошибке, код возврата `400`.
- Если входные данные неверного формата (`{"creator_id":"3"}`), то сервер паникует, а клиент не получает ответ на свой запрос.

```json
// In
{
  "creator_id":"3"
}

// Out
{
  "group_id":"4"
}
```

## POST /group/join
Предназначен для добавления пользователя с `user_id` в группу с `group_id` в качестве обычного пользователя.
- Принимает JSON объект с полями `user_id` и `group_id`.

Назовем ошибкой http-ответ с кодом `400` и телом в виде JSON объекта с полем `error` равным строке, которую назовем сообщением ошибки.
- Если нет чисел `user_id` и `group_id`, не отвечает.
- Иначе если нет группы с `group_id`, возвращает ошибку с сообщением `"no such group"`.
- Иначе если она закрыта, возвращает ошибку с сообщением `"group is closed"`.
- Иначе если пользователя с `user_id` нет, возвращает ошибку с сообщением `"no such user"`.
- Иначе если пользователь с `user_id` уже в этой группе, возвращает ошибку с сообщением `"user already in group"`.
- Иначе добавляет пользователя в группу и возвращает ответ с кодом `200` и пустым телом.

Пример входных данных
```json
{
  "user_id":2,
  "group_id":0,
}
```

# TODO

## PUT /user/update
- Изменить пользователя по `id`.

```json
// In
{
  "id":2, 
  "name":"Новое Имя"
}
// Out
{}
```


## DELETE /user/delete
- Удаляет пользователя по `id`.
```json
// In
{
  "id":2
}

// Out
{}
```


## POST /group/create - создать группу
- Создает группу и назначает администратором `creator_id`. Возвращает `group_id` созданной группы.

```json
// In
{
  "creator_id":"3"
}

// Out
{
  "group_id":"4"
}
```

## DELETE /group/delete
- Удаляет группу по `id_group` и `admin_id`. Если пользователь с `admin_id` не является администратором этой группы, выдать ошибку.
- Не забудьте удалить принадлежность участников к этой группе.
```json
// In
{
  "admin_id":2,
  "group_id":4,
}

// Out
{}
```

## POST /group/make_admin
- Делает пользователя с `member_id` администратором группы `group_id`, если `admin_id` это `id` администратора, а `member_id` уже является участником этой группы.
```json
// In
{
  "group_id":4,
  "member_id":2,
  "admin_id":3,
}

// Out
{}
```

## POST /group/unadmin
- Делает пользователя с `admin_id` пользователем группы `group_id`, если `admin_id` это `id` администратора.
```json
// In
{
  "group_id":4,
  "admin_id":3,
}

// Out
{}
```

## POST /group/quit
- Убирает пользователя с `user_id` из группы с `group_id`, если он пользователь или не является единственным администратором.
```json
// In
{
  "group_id":4,
  "user_id":2,
}

// Out
{}
```


## POST /group/secret_santa
- Запускает в группе с `group_id`, если `admin_id` это `id` администратора группы `group_id`.
- Тайный Санта:
    1. Закрыть группу
    2. Выставить всем участникам группы `santa_id`, в котором написан `id` того пользователя, для кого в группе они стали Тайным Сантой.
- На выходе выдает JSON объект соответствия `"id_пользователя":"id_кому_дарят"`.

```json
{
  "group_id":4,
  "admin_id":3,
}

// Out
{
  "3":"4",
  "4":"5",
  "5":"3"
}
```

## GET /group/target_by_id
- Для пользователя `user_id` в группе `group_id`, возвращает `id` того пользователя, для кого в группе они стали Тайным Сантой.
```json
{
  "group_id":4,
  "user_id":3,
}

// Out
{
  "id":4
}
```
